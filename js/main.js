/*! YouEpic - v0.1.0 - 2013-11-20
* http://PROJECT_WEBSITE/
* Copyright (c) 2013 Gabriel Rubens; Licensed MIT */
$(function(){var a,b=$("#urls-form"),c=$("#inputs-field"),d=$("#comments-box"),e=$("#photos-watcher-content"),f=$("#status-watcher-content"),g=($("button[type=submit]",b),$("#friends-thumbs")),h=$("div.notices"),i=$("#select-friend-box"),j=1,k={curUserID:void 0,init:function(){$("#add-url").click(function(){k.addInput()}),$("button.url-remove-btn",b).click(function(){$(this).parent().remove()}),k.shared.init(),$("#friend-search").bind("keydown keyup",function(){var a=$(this).val();k.friendSearch(a)})},localStorage:{init:function(){localStorage.MeninoGaiato||localStorage.setItem(MeninoGaiato,"{ urls: [] }")},addURL:function(a){var b=JSON.parse(localStorage.MeninoGaiato);a.constructor===Array?b.urls.push(a):b.urls=b.urls.concat(a),localStorage.MeninoGaiato=JSON.stringify(b)},delURL:function(a){var b=JSON.parse(localStorage.MeninoGaiato),c=[];$.each(b.urls,function(b,d){a!=d&&c.push(d)}),b.urls=c,localStorage.MeninoGaiato=JSON.stringify(b)}},delInput:function(){$(this).parent().remove()},addInput:function(){var a='<div class="form-group well">';a+="<input type='url' class='form-control' name='form-url-$id' placeholder='http://facebook.com/something-else'/>",a+="<br/><button type='button' ref-url='$id' class='btn btn-danger url-remove-btn'>remover</button>",a+="</div>",a.replace(/\$id/g,j),j++,a=$(a),a.find("button").bind("click",k.delInput),a.appendTo(c)},parseObjID:function(a){var b=a.match(/(comment_id=\d+)/g);return b=b[0].match(/\d+/g),b[0]},getComment:function(a,b){var c="SELECT fromid, like_info, time, comment_count, text FROM comment WHERE comment_id = "+a;FB.api({method:"fql.query",query:c},function(a){b(a)})},showComments:function(a){console.log("preparing to show commments"),console.log(a),$.each(post,function(a,b){var c=$('<div class="post"><h3>post #'+b.urlID+"</h3></div>");c.appendTo(d),$.each(b,function(a,b){var d='<div class="comment well">';d+="<h3>"+b.text+"</h3>",d+='<hr/><p class="lead">'+b.likes+" Likes</p>",d+='<p class="lead">'+b.comment_count+"  replies</p>",d+="</div>",d=$(d),d.appendTo(c)})})},shared:{objs:"photos status feed",init:function(){$.each(k.shared.objs.split(" "),function(a,b){location.href.indexOf("?u=")>-1&&(h.html('Você veio aqui pelo link que alguém ti deu, para ver é só clicar em <b>"Ver fotos/status mais curtidos"</b>-><b>"Pelo link"</b>'),$("#tab-menu .for-"+b+" li.on-link").show().find("a").bind("click",function(){location.href.indexOf("?u=")>-1&&(linkUserID=location.href.split("?u=")[1]),k[b].setAllToUser(LinkUserID)})),$("#tab-menu .for-"+b+" li.my-"+b+"-watcher a").bind("click",function(){k.curUserID=FB.getUserID(),k[b].setAllToUser()});var c="#tab-menu .for-"+b+" li.friend-"+b+"-watcher a";$(c).bind("click",function(){NProgress.inc(),k.onEvent="friend-"+b,k.getFriendID(function(a){k[b].setAllToUser(a),k.curUserID=a,NProgress.done(!0)},"friend-"+b)}),$("#"+b+"-watcher a.friend-filter-btn").bind("click",function(){k.onEvent="filter-friend-"+b,NProgress.inc(),k.getFriendID(function(a,c){k[b].setAllToUser(k.curUserID,a),h.html("Você está vendo os status/fotos que "+c+" curtiu"),NProgress.done(!0)},"filter-friend-"+b)})})},setAllToUser:function(a,b,c,d){console.log("#"+c+"-watcher!"),d=d||5,$("#"+c+"-watcher .progress").toggleClass("active"),k.forceLogin(function(e){"ok"==e?(NProgress.inc(),k[c].get(d,function(a){k[c].createView(a,function(){$("#"+c+"-watcher .progress").toggleClass("active"),h.html("Que tal compartilhar o <b>seu</b> rank com seus amigos? Aqui está o link <b>http://grsabreu.github.io/YouEpic/?u="+FB.getUserID()+"</b>")}),NProgress.done(!0)},a,b)):(h.fadeOut(50).fadeIn(100).html("<b>Ahh lek!</b> Alguma coisa deu errado, tente recarregar a página e tente de novo."),NProgress.done(!0))})}},photos:{setAllToUser:function(a,b,c){k.shared.setAllToUser(a,b,"photos",c)},get:function(a,b,c,d){a=a||3,c=c||FB.getUserID();var e="";e=d?"SELECT pid, caption, link, like_info, comment_info, src_big FROM photo WHERE object_id IN ( SELECT object_id, object_type, user_id FROM like WHERE object_id IN ( SELECT object_id FROM photo WHERE owner = "+c+" ) AND user_id = "+d+" )":"SELECT pid, caption, link, like_info, comment_info,src_big FROM photo WHERE aid IN ( SELECT aid FROM album WHERE owner = "+c+" ) ORDER BY like_info.like_count DESC LIMIT 0,"+a,FB.api({method:"fql.query",query:e},function(a){console.log(a),b(a)})},createView:function(a,b){console.log("preparing to show photos"),console.log(a),e.cleanup(),$.each(a,function(a,b){var c='<div class="photo well" style="text-align:center">';c+='<a href="'+b.link+'">',c+='<img src="'+b.src_big+'" class="img-thumbnail"/></a><hr/>',b.caption&&(c+='<p class="lead caption">"'+b.caption.replace("\n","<br>")+"</p>"),c+='<p class="lead counter">Likes '+b.like_info.like_count+" | Comments "+b.comment_info.comment_count,c+="</p>",c+="</div>",c=$(c),c.appendTo(e)}),b()}},status:{setAllToUser:function(a,b,c){k.shared.setAllToUser(a,b,"status",c)},get:function(a,b,c,d){var e="";c=c||FB.getUserID(),a=a||5,e=d?"SELECT status_id, message, like_info, comment_info FROM status WHERE status_id IN ( SELECT object_id FROM like WHERE object_id IN ( SELECT status_id FROM status WHERE uid = "+c+" ) AND user_id = "+d+" ) ORDER BY like_info.like_count DESC LIMIT 0,"+a:"SELECT message, like_info, comment_info, status_id FROM status WHERE uid = "+c+" ORDER BY like_info.like_count DESC LIMIT 0,"+a,FB.api({method:"fql.query",query:e},function(a){b(a)})},createView:function(a){console.log("preparing to show status"),console.log(a),f.cleanup(),$.each(a,function(a,b){var c='<div class="well status" style="text-align:jusfify">';c+='<h3><a href="https://facebook.com/'+k.curUserID+"/posts/"+b.status_id+'">',c+=b.message.replace("\n","<br>"),c+="</a></h3><hr/>",c+='<p class="lead"> Likes '+b.like_info.like_count,c+=" | Comments "+b.comment_info.comment_count+"</p></div>",c=$(c),c.appendTo(f)})}},comments:{},feed:{get:function(a,b){FB.api("/"+b+"/feed",function(b){a(b)})},createView:function(a){console.log("preparing to show feed"),console.log(a),feedBox.cleanup(),$.each(a,function(a,b){var c='<div class="well feed" style="text-align:jusfify">';c+='<h3><a href="'+b.story+'">',c+=status.message.replace("\n","<br>"),c+="</a></h3><hr/>",c+='<p class="lead"> '+status.like_info.like_count,c+=" | Comments "+status.comment_info.comment_count+"</p></div>",c=$(c),c.appendTo(f)})}},checkLogin:function(a){FB.getLoginStatus(function(b){"connected"==b.status?a.success&&a.success():a.error&&a.error()})},forceLogin:function(a){var b={success:function(){console.log("Hey, you're logged!"),a("ok")},error:function(){a("error"),FB.login(function(){k.checkLogin(b)},{scope:"user_photos,user_videos,user_status,friends_photos"})}};k.checkLogin(b)},sortBy:function(a,b){var c;return c=b.sort(function(b,c){return b[a]<c[a]})},friendsGot:!1,onEvent:"",getFriendID:function(b,c){function d(){if(k.onEvent==c){i.modal("hide");var a=$(this).attr("user-id"),d=$(this).text();b(a,d)}}$("#select-friend-box").modal("show"),console.log("invoking FB#api. Waiting data..."),k.friendsGot?a.bind("click",d):FB.api("/me/friends",function(b){$.each(b,function(a,b){$.each(b,function(a,b){var c='<a href="#" class="friend btn btn-primary btn-lg btn-block" user-id="'+b.id+'">';c+=b.name,c+="</a>",c=$(c),c.appendTo(g)})}),k.friendsGot=!0,a=$("#friends-thumbs .friend"),a.bind("click",d),$("#friend-search-loading-bar").hide(),$("#friend-search").fadeIn(200)})},friendSearch:function(b){b=b.toLowerCase(),""==b?a.show():a.show().each(function(){var a=$(this).text().toLowerCase();a.slice(0,b.length)!=b&&$(this).hide()})},parseURL:function(){var a=location.href;if(a.indexOf("?=u")>-1){if(a.indexOf(",")>-1){var b=a.match(/\d+,\d+/g)[0].split(",");return b}var c=a.match(/\d+/g)[0];return c}return!1},getFriendFeed:function(){k.getFriendID(function(a){console.log("MG#getFriendFeed initializing"),FB.api("/"+a+"/feed",function(){})})}};k.init(),window.MG=k,$.fn.vals=function(){var a=[];return $(this).each(function(){a.push($(this).val())}),a},$.fn.cleanup=function(){return $(this).html("")}}),function(a){"function"==typeof module?module.exports=a(this.jQuery||require("jquery")):this.NProgress=a(this.jQuery)}(function(a){function b(a,b,c){return b>a?b:a>c?c:a}function c(a){return 100*(-1+a)}function d(a,b,d){var e;return e="translate3d"===f.positionUsing?{transform:"translate3d("+c(a)+"%,0,0)"}:"translate"===f.positionUsing?{transform:"translate("+c(a)+"%,0)"}:{"margin-left":c(a)+"%"},e.transition="all "+b+"ms "+d,e}var e={};e.version="0.1.2";var f=e.settings={minimum:.08,easing:"ease",positionUsing:"",speed:200,trickle:!0,trickleRate:.02,trickleSpeed:800,showSpinner:!0,template:'<div class="bar" role="bar"><div class="peg"></div></div><div class="spinner" role="spinner"><div class="spinner-icon"></div></div>'};return e.configure=function(b){return a.extend(f,b),this},e.status=null,e.set=function(a){var c=e.isStarted();a=b(a,f.minimum,1),e.status=1===a?null:a;var g=e.render(!c),h=g.find('[role="bar"]'),i=f.speed,j=f.easing;return g[0].offsetWidth,g.queue(function(b){""===f.positionUsing&&(f.positionUsing=e.getPositioningCSS()),h.css(d(a,i,j)),1===a?(g.css({transition:"none",opacity:1}),g[0].offsetWidth,setTimeout(function(){g.css({transition:"all "+i+"ms linear",opacity:0}),setTimeout(function(){e.remove(),b()},i)},i)):setTimeout(b,i)}),this},e.isStarted=function(){return"number"==typeof e.status},e.start=function(){e.status||e.set(0);var a=function(){setTimeout(function(){e.status&&(e.trickle(),a())},f.trickleSpeed)};return f.trickle&&a(),this},e.done=function(a){return a||e.status?e.inc(.3+.5*Math.random()).set(1):this},e.inc=function(a){var c=e.status;return c?("number"!=typeof a&&(a=(1-c)*b(Math.random()*c,.1,.95)),c=b(c+a,0,.994),e.set(c)):e.start()},e.trickle=function(){return e.inc(Math.random()*f.trickleRate)},e.render=function(b){if(e.isRendered())return a("#nprogress");a("html").addClass("nprogress-busy");var d=a("<div id='nprogress'>").html(f.template),g=b?"-100":c(e.status||0);return d.find('[role="bar"]').css({transition:"all 0 linear",transform:"translate3d("+g+"%,0,0)"}),f.showSpinner||d.find('[role="spinner"]').remove(),d.appendTo(document.body),d},e.remove=function(){a("html").removeClass("nprogress-busy"),a("#nprogress").remove()},e.isRendered=function(){return a("#nprogress").length>0},e.getPositioningCSS=function(){var a=document.body.style,b="WebkitTransform"in a?"Webkit":"MozTransform"in a?"Moz":"msTransform"in a?"ms":"OTransform"in a?"O":"";return b+"Perspective"in a?"translate3d":b+"Transform"in a?"translate":"margin"},e});